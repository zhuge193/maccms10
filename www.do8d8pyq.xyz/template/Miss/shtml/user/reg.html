<!DOCTYPE html>
<html>
	<head> 
		<meta charset="UTF-8" /> 
		<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>会员注册 - {$maccms.site_name}</title> 
		<meta name="keywords" content="会员注册,{$maccms.site_keywords}" /> 
		<meta name="description" content="{$maccms.site_description}" />
		{include file="user/include"}
	</head>
	<body class="madou-min-width">
	{include file="system/header"}   
	<div class="sm:container mx-auto px-4 content-without-search">
		<h1 class="text-center text-2xl text-nord4 font-light mb-6">会员注册</h1>
	</div>	
	<div class="madou-main-info madou-min-width"> 
		<div class="madou-part-case"> 
			<div class="madou-part-layout madou-back-whits"> 
				<div class="madou-user-login"> 
					<!--
					<div class="madou-list-head madou-part-rows madou-padding"> 
						<h2 class="madou-font-xvii madou-text-center">会员注册</h2> 
					</div> 
					-->
					<form class="madou-user-form madou-user-width madou-part-rows" method="post" id="fm" action=""> 
						<input class="madou-user-text madou-col-xs12 madou-input" type="text" id="user_name" name="user_name" placeholder="请输入您的账号" /> 
						<input class="madou-user-text madou-col-xs12 madou-input" type="password" id="user_pwd" name="user_pwd" placeholder="请输入您的密码" maxlength="20" /> 
						<input class="madou-user-text madou-col-xs12 madou-input" type="password" id="user_pwd2" name="user_pwd2" placeholder="再次输入您的密码" maxlength="20" /> 
						{if condition="$user_config.reg_phone_sms neq 0"} 
						<input type="hidden" name="ac" value="phone">
						<input class="madou-user-text madou-col-xs8 madou-input" style="border-bottom-right-radius: 0;border-top-right-radius: 0;" type="text" id="to" name="to" placeholder="请输入您的手机号" /> 
						<input class="madou-user-text madou-col-xs4 madou-input" style="border-radius: .375rem;border-bottom-left-radius: 0;border-top-left-radius: 0;" type="button" id="btn_send_sms" value="获取验证码" /> 
						<input class="madou-user-text madou-col-xs12 madou-input" type="text" id="code" name="code" placeholder="请输入手机验证码" maxlength="20" /> 
						{elseif condition="$user_config.reg_email_sms neq 0"} 
						<input type="hidden" name="ac" value="email">
						<input class="madou-user-text madou-col-xs8 madou-input" style="border-bottom-right-radius: 0;border-top-right-radius: 0;" type="text" id="to" name="to" placeholder="请输入您的邮箱号" /> 
						<input class="madou-user-text madou-col-xs4 madou-input" style="border-radius: .375rem;border-bottom-left-radius: 0;border-top-left-radius: 0;" type="button" id="btn_send_sms" value="获取验证码" /> 
						<input class="madou-user-text madou-col-xs12 madou-input" type="text" id="code" name="code" placeholder="请输入邮箱验证码" maxlength="20" /> 
						{/if} 
						{if condition="$user_config.reg_verify neq 0"} 
						<input class="madou-user-text madou-col-xs8 madou-input" style="border-bottom-right-radius: 0;border-top-right-radius: 0;" type="text" id="verify" name="verify" placeholder="请输入验证码" maxlength="20" /> 
						<img class="madou-user-code madou-user-text madou-col-xs4" style="height:40px;border-radius: .375rem;border-bottom-left-radius: 0;border-top-left-radius: 0;" id="verify_img" src="{:mac_url('verify/index')}" onclick="this.src=this.src+'?'" title="看不清楚? 换一张！" /> 
						{/if} 
						<span class="madou-user-tips madou-text-gules madou-padding-v madou-visible madou-col-xs12">　</span> 
						<input class="madou-subm-regis madou-user-submit madou-rims-info madou-btns-info madou-btns-green madou-col-xs12" type="button" id="btn_submit" value="注册" /> 
						<a class="madou-padding madou-col-xs3 madou-text-left" href="{:mac_url('user/login')}">立即登录</a>
						{if condition="$GLOBALS['config']['connect']['qq']['status'] eq 0 && $GLOBALS['config']['connect']['weixin']['status'] eq 0"}
						{else/}
						{if condition="$GLOBALS['config']['connect']['qq']['status'] eq 1"} 
						<a class="madou-padding madou-col-xs3 madou-text-center" href="{:mac_url('user/oauth')}?type=qq">QQ登录</a> 
						{/if} 
						{if condition="$GLOBALS['config']['connect']['weixin']['status'] eq 1"} 
						<a class="madou-padding madou-col-xs3 madou-text-center" href="{:mac_url('user/oauth')}?type=weixin">微信登录</a> 
						{/if} 
						{/if} 
						<a class="madou-padding madou-text-right" style="float:right" href="{:mac_url('user/findpass')}">忘记密码</a> 
						<span class="madou-user-tips madou-text-gules madou-padding-v madou-visible madou-col-xs12">　</span>
					</form> 
				</div> 
			</div> 
		</div> 
	</div> 
	{include file="system/footer"}
	<script type="text/javascript">
		var countdown=60;
		function settime(val) {
			if (countdown == 0) {
				val.removeAttribute("disabled");
				val.value="获取验证码";
				countdown = 60;
				return true;
			} else {
				val.setAttribute("disabled", true);
				val.value="重新发送(" + countdown + ")";
				countdown--;
			}
			setTimeout(function() {settime(val) },1000)
		}


		$("body").bind('keyup',function(event) {
			if(event.keyCode==13){ $('#btnLogin').click(); }
		});

        $('#btn_send_sms').click(function(){
            var ac = $('input[name="ac"]').val();
            var to = $('input[name="to"]').val();
            if(ac=='email') {
                var pattern = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
                var ex = pattern.test(to);
                if (!ex) {
                    layer.msg('邮箱格式不正确');
                    return;
                }
            }
            else if(ac=='phone') {
                var pattern=/^[1][0-9]{10}$/;
                var ex = pattern.test(to);
                if (!ex) {
                    layer.msg('手机号格式不正确');
                    return;
                }
            }
            else{
                layer.msg('参数错误');
                return;
            }


            settime(this);
            var data = $("#fm").serialize();

            $.ajax({
                url: "{:mac_url('user/reg_msg')}",
                type: "post",
                dataType: "json",
                data: data,
                beforeSend: function () {
                    //开启loading
                },
                success: function (r) {
                    layer.msg(r.msg);
                },
                complete: function () {
                    //结束loading
                }
            });
        });

		$('#btn_submit').click(function() {
			if ($('#user_name').val()  == '') { layer.msg('请输入您的账号'); $("#user_name").focus(); return false; }
			if ($('#user_pwd').val()  == '') { layer.msg('请输入您的密码'); $("#user_pwd").focus(); return false; }
			if ($('#verify').val()  == '') { layer.msg('请输入验证码'); $("#verify").focus(); return false; }

			$.ajax({
				url: "{:mac_url('user/reg')}",
				type: "post",
				dataType: "json",
				data: $('#fm').serialize(),
				beforeSend: function () {
					$("#btn_submit").val("loading...");
				},
				success: function (r) {
					layer.msg(r.msg);
					if(r.code==1){
						location.href="{:mac_url('user/login')}";
					}
					else{
						$('#verify_img').click();
					}
				},
				complete: function () {
					$("#btn_submit").val("立即注册");
				}
			});

		});
	</script>  
	</body>
</html>