<!DOCTYPE html>
<html>
	<head> 
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
		<meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1" /> 
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" /> 
		<meta name="format-detection" content="telephone=no" /> 
		<title>修改资料 - {$maccms.site_name}</title> 
		<meta name="keywords" content="修改资料,{$maccms.site_keywords}" /> 
		<meta name="description" content="{$maccms.site_description}" />
		{include file="user/include"}
	</head>
	<body class="madou-min-width">
	{include file="system/header"}
	<div class="madou-main-info madou-min-width"> 
		<div class="madou-part-case"> 
			<div class="madou-user-head madou-margin-top madou-back-whits"> 
				<div class="madou-list-pics madou-lazy madou-part-5by2 madou-part-rows" style="background:url({$maccms.path}static/images/user.jpg);"> 
					<div class="madou-part-core madou-text-center"> 
					   <div class="madou-user-image" data-role="{:mac_url('user/portrait')}"> 
						<img class="face madou-user-avat madou-part-roun" src="{$obj.user_portrait|mac_default='static/images/touxiang.png'|mac_url_img}?v={:time()}" /> 
					   </div> 
					   <span class="madou-visible madou-text-white madou-padding">{$obj.user_name}</span> 
					</div> 
				</div> 
				<div class="madou-padding madou-part-rows madou-back-whits madou-hide-md"> 
					<ul class="madou-user-brief madou-part-rows madou-back-whits"> 
						<li class="madou-padding-x madou-text-center madou-col-xs4"> <span class="madou-visible madou-text-gules">{$obj.user_points}</span> <span class="madou-visible">我的积分</span> </li> 
						<li class="madou-padding-x madou-text-center madou-line-left madou-col-xs4"> <span class="madou-visible madou-text-gules">{$obj.group.group_name}</span> <span class="madou-visible">我的等级</span> </li> 
						<li class="madou-padding-x madou-text-center madou-line-left madou-col-xs4"> <span class="madou-visible madou-text-gules">{$obj.user_money}</span> <span class="madou-visible">我的余额</span> </li> 
					</ul> 
				</div> 
			</div> 
			<div class="madou-part-rows"> 
				<div class="madou-main-left madou-col-xs12 madou-col-md4 madou-col-lg3 madou-hide-xs madou-hide-sm madou-show-md-block">
				  {include file="user/menu"} 
				</div> 
				<div class="madou-main-right madou-col-xs12 madou-col-md8 madou-col-lg9"> 
					<div class="madou-part-layout madou-back-whits"> 
						<div class="madou-user-title madou-list-head madou-part-rows madou-padding madou-line-bottom"> 
							<h2 class="madou-font-xvi madou-padding">修改资料</h2> 
							<ul class="madou-part-tips madou-padding"> 
								<li class="madou-padding"> <a class="madou-more" href="{:mac_url('user/index')}">返回</a> </li> 
							</ul> 
						</div> 
						<form class="madou-user-form madou-user-info madou-part-rows" id="fm" name="fm" method="post" action=""> 
							<ul class="madou-user-list madou-part-rows madou-back-whits"> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">用户名</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone">{$obj.user_name}</span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">原密码</span> 
									<span class="madou-col-xs4 madou-col-sm6 madou-part-eone"><input class="madou-input" type="password" name="user_pwd" placeholder="原密码" maxlength="20" /></span> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone madou-text-right"><span class="madou-user-tips madou-text-gules">＊</span></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">新密码</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone"><input class="madou-input" type="password" name="user_pwd1" placeholder="新密码" maxlength="20" /></span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">重复密码</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone"><input class="madou-input" type="password" name="user_pwd2" placeholder="重复密码" maxlength="20" /></span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">QQ号码</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone"><input class="madou-input" type="text" name="user_qq" value="{$obj.user_qq}" placeholder="QQ号码" /></span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">邮件地址</span> 
									<span class="madou-col-xs6 madou-col-sm6 madou-part-eone"><input class="madou-input" type="email" name="user_email" value="{$obj.user_email}" placeholder="邮件地址" /></span> 
									<span class="madou-col-xs2 madou-col-sm3 madou-part-eone madou-text-right">{if$obj.user_email==''}<a href="{:mac_url('user/bind')}?ac=email">绑定</a>{else}<a class="madou-user-unnd btn_unbind" ac="email" href="javascript:;">解绑</a>{/if}</span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">联系手机</span> 
									<span class="madou-col-xs6 madou-col-sm6 madou-part-eone"><input class="madou-input" class="madou-input" type="tel" name="user_phone" value="{$obj.user_phone}" placeholder="联系手机" /></span> 
									<span class="madou-col-xs2 madou-col-sm3 madou-part-eone madou-text-right">{if$obj.user_phone==''}<a href="{:mac_url('user/bind')}?ac=phone">绑定</a>{else}<a class="madou-user-unnd btn_unbind" ac="phone" href="javascript:;">解绑</a>{/if}</span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">密码问题</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone"><input class="madou-input" type="text" name="user_question" value="{$obj.user_question}" placeholder="找回密码问题" /></span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows madou-line-bottom"> 
									<div class="madou-user-input madou-visible madou-font-xvi madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone">密码答案</span> 
									<span class="madou-col-xs7 madou-col-sm6 madou-part-eone"><input class="madou-input" type="text" name="user_answer" value="{$obj.user_answer}" placeholder="找回密码答案" size="40" /></span> 
									<span class="madou-col-xs1 madou-col-sm3 madou-part-eone madou-text-right"><i class="madou-icon-font madou-icon-you"></i></span> 
									</div> 
								</li> 
								<li class="madou-padding-x madou-part-rows"> 
									<span class="madou-col-xs4 madou-col-sm3 madou-part-eone madou-hide-xs">&nbsp;</span> 
									<input class="madou-subm-infos madou-col-xs7 madou-col-sm6 madou-rims-info madou-btns-info madou-btns-green madou-col-xs12" type="button" id="btn_submit" value="保存" /> 
								</li> 
							</ul> 
						</form> 
					</div> 
				</div> 
			</div> 
		</div> 
	</div> 
	{include file="system/footer"}
	<script>
		$('.btn_unbind').click(function(){
			var ac = $(this).attr('ac');
			if(ac!='email' && ac!='phone'){
				layer.msg('参数错误');
			}
			layer.confirm('确认解除绑定吗？此操作不可恢复？', {
				title: '提示',
				btn: ['确定', '取消']
			}, function() {
				$.ajax({
					url: "{:url('user/unbind')}",
					type: "post",
					dataType: "json",
					data: {ac: ac},
					beforeSend: function () {
						//开启loading
					},
					success: function (r) {
						layer.msg(r.msg);
						if(r.code==1){
							location.href="{:url('user/info')}";
						}
					},
					complete: function () {
						//结束loading
					}
				});
			});
		});

		$("#btn_submit").click(function() {
			var data = $("#fm").serialize();
			$.ajax({
				url: "{:url('user/info')}",
				type: "post",
				dataType: "json",
				data: data,
				beforeSend: function () {
					//开启loading
					//$(".loading_box").css("display","block");
					$("#btn_submit").val("loading...");
				},
				success: function (r) {
					layer.msg(r.msg);
					if(r.code==1){
						location.href="{:url('user/info')}";
					}
				},
				complete: function () {
					//结束loading
					//$(".loading_box").css("display","none");
					$("#btn_submit").val("提交");
				}
			});
		});
		
		$(".face").imageUpload({
			formAction: "{:url('user/portrait')}",
			inputFileName:'file',
			browseButtonValue: '',
			browseButtonClass:'btn btn-default btn-xs madou-user-alter madou-part-roun madou-icon-font madou-icon-xiugai',
			automaticUpload: true,
			hideDeleteButton: true,
			hover:true
		})
		$(".jQuery-image-upload-controls").mouseenter(function(){
			$(".jQuery-image-upload-controls").css("display","block");
		});
		$(".jQuery-image-upload-controls").mouseleave(function(){
			$(".jQuery-image-upload-controls").css("display","none");
		});
		$(".face").on("imageUpload.uploadFailed", function (ev, err) {
			layer.msg(err);
		});
	</script>  
	</body>
</html>