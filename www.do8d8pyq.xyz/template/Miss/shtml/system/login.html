<div class="fixed z-max inset-0 overflow-y-auto" style="display: none;">
	<div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
		<div class="fixed inset-0 bg-black bg-opacity-75 transition-opacity"></div>
		<span class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>
		<div class="w-screen inline-block align-bottom bg-nord1 rounded-lg p-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6">

			<form class="login space-y-4 sm:space-y-6" method="post" id="madouym-login" action="">
				<div>
					<h2 class="text-center text-2xl text-nord4">登入你的帐号</h2>
					<p class="mt-2 text-center text-sm leading-5 text-nord5 max-w">或 <a class="font-medium text-nord13 hover:text-nord8 focus:outline-none focus:underline signup-btn">注册一个新帐户</a></p>
				</div>
				<div class="text-group">
					<div class="rounded-b-none">
						<label>账号</label>
						<input type="text" id="login_name" name="user_name" required="">
					</div>
					<div class="rounded-t-none rounded-b-none">
						<label>密码</label>
						<input type="password" id="login_pwd" name="user_pwd" required="">
					</div>
					{if condition="$GLOBALS['config']['user']['login_verify'] eq 1"}
					<div class="rounded-t-none">
						<label>验证码</label>
						<input type="text" id="login_verify" name="verify" required="">
						<img class="verify_img" id="login_verify_img" src="{:mac_url('verify/index')}" onClick="this.src=this.src+'?'" alt="单击刷新"/>
                    </div>
					{/if}
				</div>
				<div class="relative flex items-start justify-between">
					<div class="flex">
						<div class="flex items-center h-5">
							<input id="login_remember" type="checkbox" class="focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded" checked="">
						</div>
						<div class="ml-3 text-sm">
							<label class="font-medium text-nord4">记住我</label>
						</div>
					</div>
					<div class="text-sm">
						<a href="{:mac_url('user/findpass')}" class="font-medium text-nord13 hover:text-nord8 focus:outline-none focus:underline">忘记密码?</a>
					</div>
				</div>
				<div class="block w-full rounded-md shadow-sm">
					<button id="btn_login" type="button" class="button-primary button-block" disable="">登入</button>
				</div>
			</form>
			<form class="signup space-y-4 sm:space-y-6" style="display: none;" method="post" id="madouym-signup" action="">
				<div>
					<h2 class="text-center text-2xl text-nord4">注册一个新帐号</h2>
					<p class="mt-2 text-center text-sm leading-5 text-nord5 max-w">或 <a class="font-medium text-nord13 hover:text-nord8 focus:outline-none focus:underline login-btn">登入你的帐户</a></p>
				</div>
				<div class="text-group">
					<div class="">
						<label>帐号</label>
						<input type="text" id="signup_name" name="user_name" required="">
					</div>
				</div>
				<div class="text-group">
					<div class="rounded-b-none">
						<label>密码</label>
						<input type="password" id="signup_pwd" name="user_pwd" required="">
					</div>
					<div class="rounded-t-none rounded-b-none">
						<label>确认密码</label>
						<input type="password" id="signup_pwd2" name="user_pwd2" required="">
					</div>
					{if condition="$GLOBALS['config']['user']['reg_phone_sms'] eq 1"} 
					<input type="hidden" name="ac" value="phone">
					<div class="rounded-t-none rounded-b-none">
						<label>手机号</label>
						<input type="text" id="to" name="to" required="">
						<span id="btn_send_sms" type="button" class="button-primary button-block madou-verify">获取验证码</span>
                    </div>
					<div class="rounded-b-none rounded-t-none">
						<label>手机验证码</label>
						<input type="text" id="code" name="code" required="">
					</div>
					{elseif condition="$GLOBALS['config']['user']['reg_email_sms'] eq 1"} 
					<input type="hidden" name="ac" value="email">
					<div class="rounded-t-none rounded-b-none">
						<label>邮箱号</label>
						<input type="text" id="to" name="to" required="">
						<span id="btn_send_sms" type="button" class="button-primary button-block madou-verify">获取验证码</span>
                    </div>
					<div class="rounded-b-none rounded-t-none">
						<label>邮箱验证码</label>
						<input type="text" id="code" name="code" required="">
					</div>
					{/if} 
					{if condition="$GLOBALS['config']['user']['reg_verify'] eq 1"}
					<div class="rounded-t-none">
						<label>验证码</label>
						<input type="text" id="signup_verify" name="verify" required="">
						<img class="verify_img" id="signup_verify_img" src="{:mac_url('verify/index')}" onClick="this.src=this.src+'?'" alt="单击刷新"/>
					</div>
					{/if}
				</div>
				<div class="block w-full rounded-md shadow-sm">
					<button id="btn_signup" type="button" class="button-primary button-block">注册</button>
				</div>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(function(){
		$('#btn_login').click(function() {
			if ($('#login_name').val()  == '') {layer.msg('请输入您的账号'); $("#login_name").focus(); return false; }
			if ($('#login_pwd').val()  == '') {layer.msg('请输入您的密码'); $("#login_pwd").focus(); return false; }
			if ($('#login_verify').length> 0 && $('#login_verify').val()  == '') {layer.msg('请输入验证码'); $("#login_verify").focus(); return false; }
			$.ajax({
				url: "{:mac_url('user/login')}",
				type: "post",
				dataType: "json",
				data: $('#madouym-login').serialize(),
				beforeSend: function () {
					$("#btn_login").val("loading...");
				},
				success: function (r) {
					if(r.code==1){
						layer.msg(r.msg);
						setTimeout(function(){
							location.href="{:mac_url('user/index')}";
						},1000);	
					}else{
						layer.msg(r.msg);
						$('#login_verify_img').click();
					}
				},
				complete: function () {
					$("#btn_login").val("立即登录");
				}
			});
			
		});
	});
</script>

<script type="text/javascript">
	var countdown=60;
	function settime(val) {
		if (countdown == 0) {
			val.removeAttribute("disabled");
			val.value="获取验证码";
			countdown = 60;
			return true;
		} else {
			val.setAttribute("disabled", true);
			val.value="重新发送(" + countdown + ")";
			countdown--;
		}
		setTimeout(function() {settime(val) },1000)
	}


	$('#btn_send_sms').click(function(){
		var ac = $('input[name="ac"]').val();
		var to = $('input[name="to"]').val();
		if(ac=='email') {
			var pattern = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
			var ex = pattern.test(to);
			if (!ex) {
				layer.msg('邮箱格式不正确');
				return;
			}
		}
		else if(ac=='phone') {
			var pattern=/^[1][0-9]{10}$/;
			var ex = pattern.test(to);
			if (!ex) {
				layer.msg('手机号格式不正确');
				return;
			}
		}else{
			layer.msg('参数错误');
			return;
		}

		settime(this);
		var data = $("#madouym-signup").serialize();

		$.ajax({
			url: "{:mac_url('user/reg_msg')}",
			type: "post",
			dataType: "json",
			data: data,
			beforeSend: function () {
				//开启loading
			},
			success: function (r) {
				layer.msg(r.msg);
			},
			complete: function () {
				//结束loading
			}
		});
	});

	$('#btn_signup').click(function() {
		if ($('#signup_name').val()  == '') {layer.msg('请输入您的账号'); $("#signup_name").focus(); return false; }
		if ($('#signup_pwd').val()  == '') {layer.msg('请输入您的密码'); $("#signup_pwd").focus(); return false; }
		if ($('#signup_pwd2').val()  == '') {layer.msg('请重复输入密码'); $("#signup_pwd2").focus(); return false; }
		if ($('#signup_verify').val()  == '') {layer.msg('请输入验证码'); $("#signup_verify").focus(); return false; }

		$.ajax({
			url: "{:mac_url('user/reg')}",
			type: "post",
			dataType: "json",
			data: $('#madouym-signup').serialize(),
			beforeSend: function () {
				$("#btn_signup").val("loading...");
			},
			success: function (r) {
				if(r.code==1){
					layer.msg(r.msg);
					setTimeout(function(){
						location.href="{:mac_url('user/login')}";
					},1000);	
				}else{
					layer.msg(r.msg);
					$('#signup_verify_img').click();
				}
			},
			complete: function () {
				$("#btn_signup").val("立即注册");
			}
		});
	});
</script>